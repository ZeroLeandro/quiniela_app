<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subagencia - Reporte Diario</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <h1>Subagencia - Reporte Diario</h1>
        <form id="earningsForm">
            <label for="subagency">Número de Subagencia:</label>
            <input type="text" id="subagency" name="subagency" required>

            <label for="telekino">Generado Telekino:</label>
            <input type="number" id="telekino" name="telekino" step="0.01" required>

            <label for="quini6">Generado Quini 6:</label>
            <input type="number" id="quini6" name="quini6" step="0.01" required>

            <label for="loto">Generado Loto:</label>
            <input type="number" id="loto" name="loto" step="0.01" required>

            <label for="brinco">Generado Brinco:</label>
            <input type="number" id="brinco" name="brinco" step="0.01" required>

            <label for="lotimax">Generado Lotimax:</label>
            <input type="number" id="lotimax" name="lotimax" step="0.01" required>

            <label for="quiniela">Generado Quiniela:</label>
            <input type="number" id="quiniela" name="quiniela" step="0.01" required>

            <label for="premios">Pagado en Premios:</label>
            <input type="number" id="premios" name="premios" step="0.01" required>

            <button type="button" onclick="calculateEarnings()">Calcular</button>
            <button type="button" onclick="submitEarnings()">Enviar</button>
        </form>

        <div class="result" id="result">
            <h2>Resultados</h2>
            <div id="calculatedResults">
                <p>Total Generado (después de descuentos): $<span id="totalIngresos"></span></p>
                <p>Total Final (después de restar premios): $<span id="totalFinal"></span></p>
                <p>Monto acumulado en la subagencia: $<span id="montoSubagencia"></span></p>
            </div>
        </div>
    </div>

    <script>
        function calculateEarnings() {
            const telekino = parseFloat(document.getElementById('telekino').value);
            const quini6 = parseFloat(document.getElementById('quini6').value);
            const loto = parseFloat(document.getElementById('loto').value);
            const brinco = parseFloat(document.getElementById('brinco').value);
            const lotimax = parseFloat(document.getElementById('lotimax').value);
            const quiniela = parseFloat(document.getElementById('quiniela').value);
            const premios = parseFloat(document.getElementById('premios').value);

            const telekinoFinal = telekino * 0.90;
            const quini6Final = quini6 * 0.87;
            const lotoFinal = loto * 0.90;
            const brincoFinal = brinco * 0.90;
            const lotimaxFinal = lotimax * 0.83;
            const quinielaFinal = quiniela * 0.85;

            const totalIngresos = telekinoFinal + quini6Final + lotoFinal + brincoFinal + lotimaxFinal + quinielaFinal + 5;
            const totalFinal = totalIngresos - premios;

            const montoSubagencia = telekino + quini6 + loto + brinco + lotimax + quiniela - totalIngresos ;

            document.getElementById('totalIngresos').textContent = totalIngresos.toFixed(2);
            document.getElementById('totalFinal').textContent = totalFinal.toFixed(2);
            document.getElementById('montoSubagencia').textContent = montoSubagencia.toFixed(2);

            return totalFinal;
        }

        function submitEarnings() {
            const totalFinal = calculateEarnings();

            const subagency = document.getElementById('subagency').value;
            const today = new Date().toISOString().split('T')[0];

            const earningsData = {
                date: today,
                earnings: totalFinal,
                agency: subagency
            };

            fetch('/api/earnings', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(earningsData),
            })
            .then(response => response.json())
            .then(data => {
                console.log('Earnings report sent successfully:', data);
                document.getElementById('result').innerHTML = `<p>Resultado enviado exitosamente a la central.</p>`;
            })
            .catch(error => console.error('Error:', error));
        }
    </script>
</body>
</html>
